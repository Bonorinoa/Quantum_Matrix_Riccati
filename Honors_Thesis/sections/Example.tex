\chapter{A particular case of Matrix Riccati}

In the particular case where $m=n=1$, we get the following Riccati equation:
\begin{equation}
    \frac{dy}{dt} = A(t)y^2 + B(t)y + C(t)
\end{equation}
where $A(t), B(t), C(t)$ are real-valued functions of $t$. Given an initial condition $y(0)$, we want to compute $y(t)$.

First, we convert the Riccati equation to a second order differential equations by applying the change of variables $y = - \frac{v'}{A\cdot v}$, such that we obtain the following equation:
\begin{equation*}
    v'' + v' \cdot (B - \frac{A'}{A}) + A\cdot C\cdot v = 0
\end{equation*}
Next, let $\alpha = B - \frac{A'}{A}$ and assume $A\cdot C = -1$, which must hold for the resulting matrix to be Hermitian. From this, we obtain a system with vector of unknowns $\Vec{u} = [v, z]^T$ and a matrix $M = 
    \big(\begin{smallmatrix}
      0 & 1\\
      1 & -\alpha
    \end{smallmatrix}\big)$. Therefore, we obtain the following equation $u' = M\cdot u$. We proceed by computing the characteristic polynomial to obtain the following eigenvalues:
\begin{equation*}
    \lambda_i = \frac{-\alpha \mp \sqrt{\alpha^2 + 4}}{2}, i \in \{1,2\}
\end{equation*}
and thus the corresponding eigenvectors are:
\begin{equation*}
    V_1 = [1, \lambda_1]^T; V_2 = [1, \lambda_2]^T
\end{equation*}
Finally, we construct a Passage matrix $P = \big(\begin{smallmatrix}
      1 & 1\\
      \lambda_1 & \lambda_2
    \end{smallmatrix}\big)$, such that we can rewrite our matrix $M$ as $H = P \cdot D \cdot P^{-1}$ where $D = \big(\begin{smallmatrix}
      \lambda_1 & 0\\
      0 & \lambda__2
    \end{smallmatrix}\big)$ is a diagonal matrix.
    
It follows that to solve this system we must compute $\Vec{x} = e^{tH} \cdot x_0$, where $x_0 = [u(0), z(0)]^T$. Thus, we must rewrite the problem as $e^{-tH}\cdot \Vec{x} = x_0$, where $e^{-tH} = P \cdot e^{-tD} \cdot P^{-1}$. Since we now know $e^{-tH}$ is Hermitian, we conclude by normalizing $x_0$ such that $u(0)^2 + z(0)^2 = 1$.

\subsection{Quantum Riccati Solver (QRS)}

\begin{pseudocode}[shadowbox]{QRS}{A, A', B, initCondition, T}
    \IF A \cdot C \neq -1 \AND (B + \frac{A}{A'})' \neq 0
    \THEN $\text{Display error message. Halt program.}$\\
    $\alpha$ \GETS B + \frac{A}{A'}\\
    $\lambda_1$ \GETS $(\alpha + \sqrt{\alpha^2 + 4}) / 2 $\\
    $\lambda_2$ \GETS $\alpha - \sqrt{\alpha^2 + 4}) / 2  $\\
    $\text{Compute components of new matrix \textbf{M}}$\\
    $\text{Compute vector \textbf{x} of unknowns using initCondition}$\\
    $\text{Feed \textbf{M} and \textbf{x} to HHL}$\\
    $\text{Extract the right vector components from statevector \Psi}$\\
    $y_t$ \GETS -( $z(T) / ( A(\text{T}) \cdot u(T) ) $)\\
    \OUTPUT{$y_t$}
\end{pseudocode}

\textbf{Step 0 - Prepare inputs to feed QRS}
\begin{itemize}
    \item[-] The Quantum Riccati Solver (QRS) takes as input the values for the coefficients of the equation, the initial condition $Y(T)$ and the time $T$. 
\end{itemize}


\textbf{Step 1 - Check conditions:}
\begin{itemize}
    \item[-] QRS checks the required conditions are met. If not, the program displays the error and halts. To check that $\alpha$ is indeed a constant the algorithm check it's derivative equals zero and registers the variable as a Sympy constant Quantity \cite{sympy_2022}                                                                                                   
\end{itemize}

\textbf{Step 2 - Compute Eigenvalues:}
\begin{itemize}
    \item[-] QRS computes the eigenvalues $\lambda_i, i \in \{1,2\}$ of the system of equations we derived in the previous section.
\end{itemize}

\textbf{Step 3 - Compute Components of Hermitian matrix:}
\begin{itemize}
    \item[-] The eigenvalues are then utilized to compute the values of each component in our new matrix \textbf{M}. 
\end{itemize}

\textbf{Step 4 - Find Particular Solution}
\begin{itemize}
    \item[-] Solve for $\textbf{M}\cdot \textbf{x} = b$ to compute the normalized vector of unknowns $\textbf{x}$ for the specified initial condition $Y(0)$ by calculating the values of its components $x_0 = \frac{1}{\sqrt{1 + A(0)^2 + Y(0)^2}}$ and $x_1 = - \frac{A(0)\cdot Y(0)}{\sqrt{1 + A(0)^2 + Y(0)^2}}$
\end{itemize}

\textbf{Step 5 - HHL}
\begin{itemize}
    \item[-] Feed \textbf{M} and \textbf{x} to HHL to find the solution to the given system. This is achieved by extracting the statevector $\Psi$, containing the quantum state of each qubit, from the circuit generated by the quantum computer.
\end{itemize}

\textbf{Step 6 - Return estimate of y(t)}
\begin{itemize}
    \item[-] Finally, QRS extracts the states of the qubits containing our answers and computes a numeric approximation of the solution by solving for $y_t = -(z(T) / ( A(\text{T}) \cdot u(T) ) $).
\end{itemize}